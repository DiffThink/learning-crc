= Red Hat Notes

:Author:  Parris Lucas <Parris@RedHat.com>
:Version: v1.0
:Created: 2020-09-08
:Status: Initial release

[link=https://gitter.im/DiffThink-ApplicationServices-East-MM-CSO-NA/ETA?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge] 
image::https://badges.gitter.im/DiffThink-ApplicationServices-East-MM-CSO-NA/ETA.svg[Gitter,100] 


= Introduction

**JBoss Hibernate 7.3.x - DataSource (JNDI|JPA) Ninja | OpenShift**

We are working towards creating an example demonstration JNDI|JPA|Hibernate DataSource configuration support. The common challenge to switch DataSources | Drivers in OpenShift examples.

Any advice or guidance is welcome, since I'm a JBoss EAP & OpenShift newbie.

We are currently working through a few obstacles in the following:

. new-build | start-build
. s2i artifact
. runtime artifact
. manual configuration
. editing templates

To switch between the following

- In-Memory
- SQL Server for Linus
- PostgreSQL
- Cockroach

= Background

**Our Story: electrical training ALLIANCE**

It all started with https://www.electricaltrainingalliance.org/[electrical training Alliance (ETA)], so we want to give a big shoutout to them. Thank you, ETA, for showing us the light.  Yes, "https://www.merriam-webster.com/dictionary/a%2Fthe%20squeaky%20wheel%20gets%20the%20grease%2Foilthe [squeaky will does get the grease]."


= Theory

To create frictionless documentation, instructions, and demonstrative examples for all audiences. The Professional (SMB) and Commercial (Mid-Market) developer community User eXperience (UX) concerns are not currently addressed in our Customer Portal.

_**Frictionless**_ is the key through _practicing_ the _**OPEN Source** way_. 

Audienace 

== Resource List

File Modifications

- src\main\webapp\WEB-INF\hibernate5-quickstart-ds.xml

Useful Commands

- `oc port-forward postgresql-1-4c5n8 5432:5432`


Registry Catalog

- https://access.redhat.com/containers/?count=50&sort=push_date%20desc#/category/Standalone%20Image[Red Hat Application Images]
- https://access.redhat.com/containers/?count=50&sort=push_date%20desc#/category/Programming%2520Languages%2520%2526%2520Runtimes[Programming Languages & Runtimes]


== Materials and apparatus

=== Documentaton

2.4. Import the Latest JBoss EAP for OpenShift Imagestreams and Templates

- https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.3/html-single/getting_started_with_jboss_eap_for_openshift_container_platform/index#import_command_for_jdk_11_imagestreams[Import command for JDK 11 imagestreams]
-


Sources

- https://github.com/wildfly-extras/wildfly-datasources-galleon-pack[]
- https://github.com/jboss-developer/jboss-developer-shared-resources/blob/master/guides/CONFIGURE_POSTGRESQL_JBOSS_EAP.adoc#configure_the_postgresql_database_for_use_with_the_quickstarts[Configure the PostgreSQL Database]
* https://github.com/jboss-developer/jboss-developer-shared-resources/blob/master/guides/CONFIGURE_POSTGRESQL_JBOSS_EAP.adoc#add-the-postgresql-module-to-the-jboss-eap[Add the PostgreSQL Module to the JBoss EAP]
* https://github.com/jboss-developer/jboss-developer-shared-resources/blob/master/guides/CONFIGURE_POSTGRESQL_JBOSS_EAP.adoc#configure-the-postgresql-driver-in-the-jboss-eap-server[Configure the PostgreSQL Driver in the JBoss EAP Server]


- https://access.redhat.com/articles/2026253[Red Hat JBoss Enterprise Application Platform (EAP) 7 Supported Configurations]

Downloads

- http://jdbc.postgresql.org/download.html[PostgreSQLJBDC Drivers]
* https://jdbc.postgresql.org/download/postgresql-42.2.16.jar[PostgreSQL JDBC 4.2 Driver, 42.2.16]


=== JBoss EAP Templates

Identifying the correct templates for EAP ^7.3, PostgreSQL ^12.x and OpenShift ^4.3

.\oc new-project eap-demo.ps1[Installed the following templates for EAP 7.3]

=== JBOSS EAP Deployment

[eap73-openjdk11-example]
====
```! powershell
oc new-app --template=eap73-openjdk11-third-party-db-s2i.json  `
 -p IMAGE_STREAM_NAMESPACE=eap-demo-02 `
 -p SOURCE_REPOSITORY_URL=https://github.com/jboss-developer/jboss-eap-quickstarts `
 -p SOURCE_REPOSITORY_REF=EAP_7.3.0.GA `
 -p GALLEON_PROVISION_LAYERS=standalone `
 -p CONTEXT_DIR=hibernate
 ```
====

. --template
. -p, --param=[] (Parmeters)
* IMAGE_STREAM_NAMESPACE
* SOURCE_REPOSITORY_URL
* SOURCE_REPOSITORY_REF
* GALLEON_PROVISION_LAYERS
* CONTEXT_DIR
. -e, --env=[]
. -l, --labels=''

==== Source Repoistory

Make sure useing the correct tag or release.


==== Galleon Provision

Used standalone for my testing, yet should be able to use `jpa` or `cloud-profile` (recomended)


## PostgreSQL DataSource & Driver

The [JBOSS EAP 7.3.0.GA Quickstart] provide a good example to use to configure Hibernate|JPA. This provided the core information to determine some of the challenges around the driver and datasource.


### JBOSS EAP Configurations


image::resources\images\Annotation2020-09-08-162952.png[Standalone-Full.xml Driver Changes]



### Red Hat JBoss Enterprise Application Platform (JBoss EAP) Quickstarts

[[optional_components]]
== Configure Optional Components

The following components are needed for only a small subset of the quickstarts. Do not install or configure them unless the quickstart requires it.

* xref:create_quickstart_users[Create Quickstart Users]
* xref:configure_postgresql[Configure the PostgreSQL Database]
* xref:configure_byteman[Configure Byteman]

[[create_quickstart_users]]
=== Create Quickstart Users

Some of the quickstarts, particularly those that run in a secured mode and demonstrate security, require that you create quickstart users with different roles for authorization purposes. See https://github.com/jboss-developer/jboss-developer-shared-resources/blob/master/guides/CREATE_USERS.adoc#create_users_required_by_the_quickstarts[Create Users Required by the Quickstarts] for detailed instructions to create users required by the quickstarts.

[[configure_postgresql]]
=== Configure the PostgreSQL Database

Some of the quickstarts that demonstrate transactions require that you install and configure the PostgreSQL database. See https://github.com/jboss-developer/jboss-developer-shared-resources/blob/master/guides/CONFIGURE_POSTGRESQL_JBOSS_EAP.adoc#configure_the_postgresql_database_for_use_with_the_quickstarts[Configure the PostgreSQL Database for Use with the Quickstarts] for instructions.


= Procedure

Journal every step of the way to document for Application Service BU, Marketing & Technology Operations, and related teams the challenges of engaging with Professional and Commerical Open Source contributors.

The current steps are documented in the

- Red Hat Notes
- https://github.com/DiffThink/learning-crc/blob/feature/osd-eap-hibernate/oc%20new-project%20eap-demo.ps1[OpenShift New JBoss EAP Hibernate|JNDI|JPA Demonstration Journal]

= Workplan

**JBoss EAP Hibernate | JNDI | JPA**

Initial learn to all approaches using the OC | ODO client tools, and then followed functional testing using web console exclusively  (_**no** client tools_)

- Learn
. Identify several approaches to configure hibernate for OpenShift 4.x
** [ ] Build Configuration Approach
** [ ] Deployment Configuration Approach
** [ ] S2I Artifact Deployment Approach
** [ ] Runtime Artifact Deployment Approach
** [ ] Manual Configuration Deployment Approach
. Identify the lessons learned from each approach
. Test, Test, Test
** [ ] Integration Test
** [ ] Functional Test
** [ ] _Grandmother_ Test 
- Practice
- Master



= Results

= Discussion

= Conclusion

== Gratuity

**Professional & Commerical Open Source Community Influencers**

- Stephen Boyd, electrical training ALLIANCE (ETA)
- Han Chung, American Bible Society (ABS) 

**Red Hatters**

- Daniel Oh
- Eric Deandrea
- Paul Vergilis
- Red Hat Application Development CoP 


= Recommendations
